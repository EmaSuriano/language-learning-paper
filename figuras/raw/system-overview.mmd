graph TD
    %% User Interaction
    A[User Interaction] -->|Query/Answer| B[RAG System]
    A -->|Feedback| H[RL Agent]

    %% RAG System
    subgraph RAG System
        B --> C[Retriever]
        B --> D[Generator]
        C --> E[Vector Database]
        E --> F[Document Store]
        F -->|Documents and Metadata| E
        F -->|Structured Data| I[SQL Database]
        C -->|Relevant Context| D
        D -->|Response| J[Response Builder]
    end

    %% RL Agent
    subgraph RL Agent
        H --> K[State Representation]
        H --> L[Reward System]
        H -->|Policy Updates| B
        K -->|User Profile and History| H
        L -->|Reward Signal| H
    end

    %% Connections and Final Output
    J -->|Generated Response| A
    H -->|Action Selection| J
    H -->|Adaptive Strategy| B

    %% External Components
    I -->|Metadata Retrieval| C
    I -->|Feedback for Reward| L